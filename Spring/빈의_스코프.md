> ğŸ“š ë³¸ ê¸€ì€ ì¸í”„ëŸ° ê°•ì˜ 'ìŠ¤í”„ë§ í•µì‹¬ ê¸°ìˆ 'ì„ ë“£ê³  ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤. 

<br>

# **1. ë¹ˆì˜ ìŠ¤ì½”í”„**

ì´ì „ì—ë„ ë§í–ˆë“¯ì´ ì•„ë¬´ëŸ° ì„¤ì •ì„ í•˜ì§€ ì•Šìœ¼ë©´ ìŠ¤í”„ë§ì€ ê¸°ë³¸ì ì¸ ìŠ¤ì½”í”„ë¡œ ì‹±ê¸€í†¤ì„ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤. 
ê·¸ë ‡ë‹¤ë©´ **ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ë€?** Application ì „ë°˜ì— ê±¸ì³ì„œ í•´ë‹¹ ë¹ˆì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë‹¨ í•œê²Œë§Œ ê°€ì§€ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤. 

ê·¸ì™€ ìƒë°˜ë˜ëŠ” ìŠ¤ì½”í”„ë¡œëŠ” **í”„ë¡ì‹œ ìŠ¤ì½”í”„** ê°€ ìˆìŠµë‹ˆë‹¤. í”„ë¡ì‹œ ìŠ¤ì½”í”„ëŠ” ë§¤ë²ˆ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤. 

ì½”ë“œë¥¼ í†µí•´ ì´í•´ë¥¼ ë„ì™€ë´…ì‹œë‹¤. 
```java
//Prototype í´ë˜ìŠ¤

@Component @Scope("prototype")
public class Proto {}

// ì•„ë¬´ëŸ° ì„¤ì •ì„ í•˜ì§€ ì•Šì€ ì‹±ê¸€í†¤ í´ë˜ìŠ¤ 
@Component
public class Single {}

// ì‹¤í–‰ í´ë˜ìŠ¤ 
@Component
public class AppRunner implements ApplicationRunner {

    @Autowired
    ApplicationContext ctx;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        System.out.println("Proto");
        System.out.println(ctx.getBean(Proto.class));
        System.out.println(ctx.getBean(Proto.class));
        System.out.println(ctx.getBean(Proto.class));

        System.out.println("Single");
        System.out.println(ctx.getBean(Single.class));
        System.out.println(ctx.getBean(Single.class));
        System.out.println(ctx.getBean(Single.class));
    }
}
```
ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¨ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 

```java
Proto
me.whiteship.dempspring51.Proto@6af5bbd0
me.whiteship.dempspring51.Proto@76464795
me.whiteship.dempspring51.Proto@b34832b
Single
me.whiteship.dempspring51.Single@48f4713c
me.whiteship.dempspring51.Single@48f4713c
me.whiteship.dempspring51.Single@48f4713c
```

ë³´ì´ëŠ” ê²°ê³¼ì™€ ê°™ì´ Proto íƒ€ì…ì˜ ìŠ¤ì½”í”„ë¥¼ ê°–ëŠ” ì¸ìŠ¤í„´ìŠ¤ëŠ” ëª¨ë‘ ë‹¤ë¥¸ ê°’ì´ ì¶œë ¥ë©ë‹ˆë‹¤. ë°˜ë©´ ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ë¥¼ ê°€ì§„ ì¸ìŠ¤í„´ìŠ¤ëŠ” ëª¨ë‘ ê°™ì€ ê°’ì´ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

---
## **1.1 ì‹±ê¸€í†¤ ë¹ˆì´ í”„ë¡œí† íƒ€ì…ì˜ ë¹ˆì„ ì°¸ì¡°í•˜ë©´?**

í•˜ì§€ë§Œ ë§Œì•½ ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ë¥¼ ê°€ì§„ í´ë˜ìŠ¤ ë‚´ì—ì„œ proto ìŠ¤ì½”í”„ë¥¼ ê°€ì§„ í´ë˜ìŠ¤ë¥¼ ì¶œë ¥í•˜ë„ë¡ í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”? ì½”ë“œë¡œ ì‹¤í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤. 

```java
@Component
public class Single {

    @Autowired
    Proto proto;

    public Proto getProxy() {
        return proto;
    }
}
```
ì‹¤í–‰ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. 
```java
@Component
public class AppRunner implements ApplicationRunner {

    @Autowired
    ApplicationContext ctx;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        System.out.println("proto by single");
        System.out.println(ctx.getBean(Single.class).getProto());
        System.out.println(ctx.getBean(Single.class).getProto());
        System.out.println(ctx.getBean(Single.class).getProto());
    }
}

// ì‹¤í–‰ê²°ê³¼
me.whiteship.dempspring51.Proto@3f183caa
me.whiteship.dempspring51.Proto@3f183caa
me.whiteship.dempspring51.Proto@3f183caa
```
Proto ìŠ¤ì½”í”„ë¥¼ ê°–ëŠ” í´ë˜ìŠ¤ë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ë¥¼ ê°€ì§„ í´ë˜ìŠ¤ë‚´ì—ì„œ ê°ì²´ë¥¼ êº¼ë‚´ì˜¤ëŠ” ë°©ë²•ì´ê¸° ë•Œë¬¸ì— ë™ì¼í•œ ê²°ê³¼ê°€ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

---
## **1.2 ìœ„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•**

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡  ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì´ ì¡´ì¬í•©ë‹ˆë‹¤. 

### 1. ProxyModeë¥¼ ì‚¬ìš©í•˜ê¸° 

proxyModeë¥¼ Scopeì„¤ì •ê³¼ í•¨ê»˜ ì„¤ì •í•¨ìœ¼ë¡œì¨ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
```java
@Component @Scope(value = "prototype",proxyMode = ScopedProxyMode.TARGET_CLASS)
public class Proto {}
```
ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ë³€ê²½í•œ í›„ ì‹¤í–‰í•˜ë©´ ëª¨ë‘ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ê°’ì„ ê°–ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì„ ê²ƒ ì…ë‹ˆë‹¤. 

proxyModeì˜ ê¸°ë³¸ê°’ì€ DEFAULTë¡œ ë˜ì–´ìˆìœ¼ë©°, DEFAULTëŠ” í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤. proxyModeë¥¼ ì„¤ì •í•˜ì—¬ DEFAULTê°€ ì•„ë‹Œ ë‹¤ë¥¸ ê²ƒìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì€ proxyë¥¼ ì‚¬ìš©í•˜ê² ë‹¤! í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ proxyë¡œ ê°ì‹¸ê² ë‹¤! ë¼ê³  ì´í•´í•˜ë©´ ë©ë‹ˆë‹¤. 

**ì¦‰, ì„¤ì •ìœ¼ë¡œ ê°ì‹¼ proxy ë¹ˆì„ ì‚¬ìš©í•˜ê²Œ í•´ë¼ ì…ë‹ˆë‹¤.**

ë§Œì•½ ì„¤ì •ì„ TARGET_CLASSë¡œ ë³€ê²½í•˜ë©´ TARGET_CLASSë¡œ ê°ì‹¼ proxy ë¹ˆì„ ì‚¬ìš©í•˜ê²Œ í•´! ë¼ê³  ë§í•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤. ê·¸ë¦¼ìœ¼ë¡œ ì‚´í´ë³´ìë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 

![image](https://user-images.githubusercontent.com/63777714/139543525-6ccc9a7b-05b2-4309-a3ba-47233c5ba634.png)

ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ë¥¼ ê°€ì§„ ë¹ˆì´ Protoíƒ€ì…ì˜ ë¹ˆë¥¼ ì§ì ‘ ì°¸ì¡°í•˜ê²Œ ëœë‹¤ë©´ ê·¸ë•Œë§ˆë‹¤ Proto ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì‹±ê¸€í†¤ ë¹ˆì´ ìƒì„±ë  ë•Œ ì´ë¯¸ ë§Œë“¤ì–´ì§„ Proto ë¥¼ ê°€ì§€ê³  ì˜¤ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ Proxyë¡œ í•œ ë²ˆ ê°ì‹¸ì„œ, Protoê°€ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒ ì…ë‹ˆë‹¤. 

### 2. Object-Provider ì‚¬ìš©í•˜ê¸°

```java
@Component
public class Single {

    @Autowired
    private ObjectProvider<Proto> proto;

    public Proto getProto() {
        return proto.getIfAvailable();
    }
}

// ì‹¤í–‰ê²°ê³¼
proto by single
me.whiteship.dempspring51.Proto@4fe64d23
me.whiteship.dempspring51.Proto@6af5bbd0
me.whiteship.dempspring51.Proto@b34832b
```
ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

---