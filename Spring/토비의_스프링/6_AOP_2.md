> 📚 본 글은 토비의 스프링 3.1을 읽고 정리한 글입니다. 

<br>

# **6장 AOP_2**
# **스프링 AOP**
이제까지 반복되는 프록시의 메소드 구현을 코드 자동생성 기법을 이용해 해결했다면 반복적인 ProxyFactoryBean 설정 문제도 자동등록하는 기법이 없을까? 또는 실제 빈 오브젝트가 되는 것은 ProxyFactoryBean을 통해 생성되는 프록시 그 자체이므로 프록시가 자동으로 빈으로 생성할 수 없을까?

## **빈 후처리기를 이용한 자동 프록시 생성기**
스프링은 컨테이너로서 제공하는 기능 중에서 변하지 않는 핵심적인 부분 외에는 대부분 확장할 수 있도록 확장 포인트를 제공해주낟. 
그 중 하나인 `BeanPostProcessor` 인터페이스를 구현해서 만드는 빈 후처리기는 말 그대로 스프링 빈 오브젝트로 만들어지고 난 후에, 빈 오브젝트를 다시 가공할 수 있게 해준다. 

스프링이 제공하는 빈 후처리기 중의 하나인 `DefaultAdvisorAutiProxyCreator` 에 대해서 살펴보자.

`DefaultAdvisorAutiProxyCreator` 는 어드바이저를 이용한 자동 프록시 생성기다. 빈 후처리기가 스프링 빈으로 등록하는 방법은 빈 후처리가 자체를 빈으로 등록하는 방법을 사용한다. 스프링은 빈 후처리기가 빈으로 등록되어 있으면 빈 오브젝트가 생성될 때마다 빈 후처리기에 보내서 후처리 작업을 요청한다. 
* 빈 후처리기는 빈 오브젝트의 프로퍼티를 강제로 수정할 수 있다.
* 별도의 초기화 작업을 수행할 수 있다.
* 만들어진 빈 오브젝트를 강제로 바꿔치기할 수 있다. 
* 스프링이 설정을 참고해서 만든 오브젝트가 아닌 다른 오브제그를 빈으로 등록시키는 것도 가능하다.
위의 빈 후처리기의 특징을 잘 이용한다면 스프링이 생성하는 빈 오브젝트의 일부를 프록시로 포장하고, 프록시를 빈으로 대신 등록할 수도 있다.

## **확장된 포인트컷**
포인트 컷의 인터페이스는 다음과 같이 구성되어있다.
```java
public interface Pointcut {
    ClassFilter getClassFilter(); //프록시를 적용할 클래스인지 확인
    MethodMatcher getMethodMatcher(); //어드바이스를 적용할 메소드인지 확인
}
```
포인트컷은 ClassFilter, MethodMatcher를 돌려주는 메소드를 갖고 있다. 이제까지는 메소드 선정 기능만 필요하였지만 DefaultAdvisorAutoProxyCreator는 클래스와 메소드 선정 알고리즘 모두가 필요하다. 두 가지 모두 충족해야 어드바이스가 적용된다.

## **포인트컷 표현식을 이용한 포인트컷**
스프링은 아주 간단하고 효과적인 방법으로 포인트컷의 클래스와 메소드를 선정하는 알고리즘을 작성할 수 있는 방법을 제공한다. 이것을 **포인트컷 표현식**이라고 부른다. 이를 적용하려면 AspectJExpressionPointcut 클래스를 사용하면 된다. 스프링이 사용하는 포인트컷 표현식은 AspectJ라는 프레임워크에서 제공하는 것을 가져와 일부 문법을 확장해서 사용하는 것이다. 

```java
execution([접근제한자 패턴] 타입패턴 [타입패턴.]이름패턴 (타입패턴 | "..", ...) [throws 예외 패턴])

```
* 접근제한자 패턴 - public, protected, private 등이 올 수 있다. 포인트컷 표현식에서 생략가능하다.
* 타입 패턴 - 리턴값의 타입을 나타내는 패턴
* 타입 패턴(2번쨰) - 생략가능, 패키지와 타입이름을 포함한 클래스의 타입패턴
* 이름 패턴 - 메소드 이름 패턴이다. 필수항목, 모든 메소드가 대상이면 * 
* (타입패턴 | "..", ...) - 파라미터의 타입 패턴을 순서대로 넣을 수 있다. 와일드카드를 이용해 개수에 상관없는 패턴 생성도 가능
